%%
%% This is file `notation.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% notation.dtx  (with options: `package')
%% 
%% IMPORTANT NOTICE:
%% 
%% For the copyright see the source file.
%% 
%% Any modified versions of this file must be renamed
%% with new filenames distinct from notation.sty.
%% 
%% For distribution of the original source see the terms
%% for copying and modification in the file notation.dtx.
%% 
%% This generated file may be distributed as long as the
%% original source files, as listed above, are part of the
%% same distribution. (The sources need not necessarily be
%% in the same archive or directory.)
\NeedsTeXFormat{LaTeX2e}
\ProvidesExplPackage{notation}{2025/08/21}{0.1}
  {AI/ML notation helpers with auto notation table}

\RequirePackage{expl3,xparse}
\RequirePackage{booktabs}
\RequirePackage{array}
\RequirePackage{mathtools,longtable}

\ExplSyntaxOn
\prop_new:N \g_note_example_prop
\prop_new:N \g_note_description_prop
\prop_new:N \g_note_used_prop

\cs_new_protected:Npn \note_mark_used:n #1
  {
    \prop_gput:Nnn \g_note_used_prop {#1} {1}
  }

\cs_new_protected:Npn \note_catalog_put:nnn #1#2#3
  { % name, ex, desc

    % Example
    \prop_put:Nnn \g_note_example_prop {#1} {#2}

    % Description
    \prop_put:Nnn \g_note_description_prop {#1} {#3}

  }


\NewDocumentCommand \NotationUsedTable { }
  {
    \longtable{>{\raggedright\arraybackslash}l%
               >{\raggedright\arraybackslash}p{0.7\linewidth}}
    \toprule
    \textbf{Symbol} & \textbf{Description} \\
    \midrule
    \endfirsthead
    \toprule
    \textbf{Symbol} & \textbf{Description} \\
    \midrule
    \endhead
    \bottomrule
    \endfoot
    %
    \seq_clear_new:N \l__note_rows_seq
    \prop_map_inline:Nn \g_note_description_prop
      {
        \prop_if_in:NnT \g_note_used_prop {##1}
          {
            \prop_get:NnN \g_note_example_prop {##1} \l__note_ex_tl
            \tl_set:Nn \l__note_desc_tl {##2}
            \seq_put_right:Nx \l__note_rows_seq
              {
                \exp_not:N \ensuremath{\tl_use:N \l__note_ex_tl}
                \c_space_tl & \tl_use:N \l__note_desc_tl
              }
          }
      }
    \seq_use:Nn \l__note_rows_seq {\\}
    \endlongtable
  }

\NewDocumentCommand \DeclareNotation { m O{} m O{} +m }
  {

    % fallback: if the example is empty, use the macro itself
    \tl_if_blank:nTF {#4}
      { \note_catalog_put:nnn {#1}{#1}{#5} }
      { \note_catalog_put:nnn {#1}{#4}{#5} }

    \cs_if_exist:NTF #1
      { \RenewDocumentCommand #1 { #2 } { \note_mark_used:n { #1 }  #3 } }
      { \NewDocumentCommand   #1 { #2 } { \note_mark_used:n { #1 }  #3 } }
  }



\ExplSyntaxOff
\endinput
%%
%% End of file `notation.sty'.
